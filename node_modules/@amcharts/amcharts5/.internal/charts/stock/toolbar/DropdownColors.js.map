{"version":3,"file":"DropdownColors.js","sourceRoot":"","sources":["../../../../../../src/.internal/charts/stock/toolbar/DropdownColors.ts"],"names":[],"mappings":"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","sourcesContent":["import { Color, color } from \"../../../core/util/Color\";\r\n\r\nimport { ColorSet } from \"../../../core/util/ColorSet\";\r\nimport { Dropdown, IDropdownSettings, IDropdownPrivate, IDropdownEvents } from \"./Dropdown\"\r\n\r\nimport * as $array from \"../../../core/util/Array\";\r\nimport * as $utils from \"../../../core/util/Utils\";\r\n\r\nexport interface IDropdownColorsSettings extends IDropdownSettings {\r\n\tcolors?: ColorSet;\r\n\tuseOpacity?: boolean;\r\n}\r\n\r\n\r\nexport interface IDropdownColorsPrivate extends IDropdownPrivate {\r\n\tlist?: HTMLUListElement;\r\n\tcolor?: Color;\r\n\topacity?: number;\r\n}\r\n\r\nexport interface IDropdownColorsEvents extends IDropdownEvents {\r\n\tinvoked: {\r\n\t\tcolor: Color;\r\n\t};\r\n\r\n\tinvokedOpacity: {\r\n\t\topacity: number;\r\n\t};\r\n}\r\n\r\n/**\r\n * A dropdown used for color picker control.\r\n *\r\n * Should not be used as standalone control.\r\n */\r\nexport class DropdownColors extends Dropdown {\r\n\tpublic static className: string = \"DropdownColors\";\r\n\tpublic static classNames: Array<string> = Dropdown.classNames.concat([DropdownColors.className]);\r\n\r\n\tdeclare public _settings: IDropdownColorsSettings;\r\n\tdeclare public _privateSettings: IDropdownColorsPrivate;\r\n\tdeclare public _events: IDropdownColorsEvents;\r\n\r\n\t// private _itemDisposers: Array<IDisposer> = [];\r\n\r\n\tprotected _afterNew() {\r\n\t\tsuper._afterNew();\r\n\t\tthis._setupKeyboardNav();\r\n\t\tthis._root.addDisposer(this);\r\n\t}\r\n\r\n\tprotected _initElements(): void {\r\n\t\tsuper._initElements();\r\n\r\n\t\t// Create container\r\n\t\tconst container = this.getPrivate(\"container\")!;\r\n\r\n\t\t// Create list\r\n\t\tconst list = document.createElement(\"ul\");\r\n\t\tlist.className = \"am5stock-control-colors\";\r\n\t\tcontainer.appendChild(list);\r\n\t\tthis.setPrivate(\"list\", list);\r\n\r\n\t\tthis._initItems();\r\n\t}\r\n\r\n\tprotected _initItems(): void {\r\n\t\tconst list = this.getPrivate(\"list\")!;\r\n\t\tlist.innerHTML = \"\";\r\n\r\n\t\tlet cs = this.get(\"colors\");\r\n\t\tif (!cs) {\r\n\t\t\tcs = ColorSet.new(this._root, {});\r\n\t\t}\r\n\t\tconst colors = cs.get(\"colors\", []);\r\n\t\t$array.each(colors, (item) => {\r\n\t\t\tthis.addItem(item);\r\n\t\t});\r\n\t\tthis._initOpacity();\r\n\t\tthis._maybeMakeAccessible();\r\n\t}\r\n\r\n\tpublic _beforeChanged() {\r\n\t\tsuper._beforeChanged();\r\n\r\n\t\tif (this.isDirty(\"colors\") || this.isDirty(\"useOpacity\") || this.isPrivateDirty(\"color\") || this.isPrivateDirty(\"opacity\")) {\r\n\t\t\tthis._initItems();\r\n\t\t}\r\n\r\n\t\tif (this.isDirty(\"control\")) {\r\n\t\t\tthis._maybeMakeAccessible();\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprotected _dispose(): void {\r\n\t\tsuper._dispose();\r\n\t}\r\n\r\n\tpublic addItem(color: Color): void {\r\n\t\tconst currentColor = this.getPrivate(\"color\") ? this.getPrivate(\"color\")!.hex : 0;\r\n\t\tconst list = this.getPrivate(\"list\")!;\r\n\t\tconst item = document.createElement(\"li\");\r\n\t\titem.className = \"am5stock-control-color\";\r\n\t\tif (currentColor == color.hex) {\r\n\t\t\titem.className += \" am5stock-control-active\";\r\n\t\t}\r\n\t\titem.style.background = color.toCSS();\r\n\t\tlist.appendChild(item);\r\n\r\n\t\t// Add click event\r\n\t\tthis._disposers.push($utils.addEventListener(item, \"click\", (_ev) => {\r\n\t\t\tthis.hide();\r\n\t\t\tthis.events.dispatch(\"invoked\", {\r\n\t\t\t\ttype: \"invoked\",\r\n\t\t\t\tcolor: color,\r\n\t\t\t\ttarget: this\r\n\t\t\t});\r\n\t\t}));\r\n\t}\r\n\r\n\tprotected _initOpacity(): void {\r\n\t\tif (this.get(\"useOpacity\")) {\r\n\t\t\tconst currentOpacity = this.getPrivate(\"opacity\", 1);\r\n\t\t\tconst list = this.getPrivate(\"list\")!;\r\n\t\t\tconst hr = document.createElement(\"hr\");\r\n\t\t\tlist.appendChild(hr);\r\n\r\n\t\t\tfor (let opacity = 100; opacity >= 0; opacity -= 25) {\r\n\t\t\t\tconst fill = color(0x000000);\r\n\t\t\t\tconst item = document.createElement(\"li\");\r\n\t\t\t\titem.innerHTML = opacity + \"%\";\r\n\t\t\t\titem.className = \"am5stock-control-opacity am5stock-control-opacity-\" + opacity;\r\n\t\t\t\tif (currentOpacity * 100 == opacity) {\r\n\t\t\t\t\titem.className += \" am5stock-control-active\";\r\n\t\t\t\t}\r\n\t\t\t\titem.style.background = fill.toCSS(opacity / 100);\r\n\t\t\t\tlist.appendChild(item);\r\n\r\n\t\t\t\t// Add click event\r\n\t\t\t\tthis._disposers.push($utils.addEventListener(item, \"click\", (_ev) => {\r\n\t\t\t\t\tthis.hide();\r\n\t\t\t\t\tthis.events.dispatch(\"invokedOpacity\", {\r\n\t\t\t\t\t\ttype: \"invokedOpacity\",\r\n\t\t\t\t\t\topacity: opacity / 100,\r\n\t\t\t\t\t\ttarget: this\r\n\t\t\t\t\t});\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _setupKeyboardNav(): void {\r\n\t\tif ($utils.supports(\"keyboardevents\")) {\r\n\t\t\tconst button = this.get(\"control\").getPrivate(\"button\")!;\r\n\t\t\tthis._disposers.push($utils.addEventListener(document, \"keydown\", (ev: KeyboardEvent) => {\r\n\t\t\t\tif (this.isAccessible()) {\r\n\t\t\t\t\tif (document.activeElement && (document.activeElement === button || $utils.contains(button, document.activeElement))) {\r\n\t\t\t\t\t\tif (ev.keyCode == 13) {\r\n\t\t\t\t\t\t\t// ENTER\r\n\t\t\t\t\t\t\tif (document.activeElement !== button) {\r\n\t\t\t\t\t\t\t\t(document.activeElement as HTMLElement).click();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if ([37, 38, 39, 40].indexOf(ev.keyCode) !== -1) {\r\n\t\t\t\t\t\t\tconst dir = ev.keyCode == 37 || ev.keyCode == 38 ? -1 : 1;\r\n\t\t\t\t\t\t\tconst items = this._getActiveItems();\r\n\t\t\t\t\t\t\tconst selected = button.querySelectorAll(\".am5stock-control-color:focus, .am5stock-control-opacity:focus\");\r\n\t\t\t\t\t\t\tlet index: number = -1;\r\n\t\t\t\t\t\t\tif (selected.length > 0) {\r\n\t\t\t\t\t\t\t\titems.forEach((item, key) => {\r\n\t\t\t\t\t\t\t\t\tif (item === selected.item(0)) {\r\n\t\t\t\t\t\t\t\t\t\tindex = key;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tindex += dir;\r\n\t\t\t\t\t\t\tif (index < 0) {\r\n\t\t\t\t\t\t\t\tindex = items.length - 1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (index >= items.length) {\r\n\t\t\t\t\t\t\t\tindex = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$utils.focus(items.item(index) as HTMLElement);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _maybeMakeAccessible(): void {\r\n\t\tsuper._maybeMakeAccessible();\r\n\t\tif (this.isAccessible()) {\r\n\t\t\t//const tabindex = this._root.tabindex.toString();\r\n\t\t\t//const list = this.getPrivate(\"list\")!;\r\n\t\t\tconst items = this._getActiveItems();\r\n\t\t\titems.forEach((item, key) => {\r\n\t\t\t\t(item as HTMLElement).setAttribute(\"tabindex\", \"-1\");\r\n\t\t\t\t(item as HTMLElement).setAttribute(\"aria-label\", this.root.language.translateAny(\"Selection\") + \" #\" + (key + 1));\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _getActiveItems(): NodeList {\r\n\t\treturn this.getPrivate(\"list\")!.querySelectorAll(\".am5stock-control-color, .am5stock-control-opacity\");\r\n\t}\r\n\r\n}"]}