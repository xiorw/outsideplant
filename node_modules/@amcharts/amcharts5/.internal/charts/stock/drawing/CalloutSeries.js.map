{"version":3,"file":"CalloutSeries.js","sourceRoot":"","sources":["../../../../../../src/.internal/charts/stock/drawing/CalloutSeries.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Label } from \"../../../core/render/Label\";\r\nimport type { Container } from \"../../../core/render/Container\";\r\nimport type { DataItem } from \"../../../core/render/Component\";\r\n\r\nimport { LabelSeries, ILabelSeriesSettings, ILabelSeriesPrivate, ILabelSeriesDataItem } from \"./LabelSeries\";\r\nimport { PointedRectangle } from \"../../../core/render/PointedRectangle\";\r\nimport { Template } from \"../../../core/util/Template\";\r\n\r\nimport * as $ease from \"../../../core/util/Ease\";\r\n\r\n\r\nexport interface ICalloutSeriesDataItem extends ILabelSeriesDataItem {\r\n}\r\n\r\nexport interface ICalloutSeriesSettings extends ILabelSeriesSettings {\r\n}\r\n\r\nexport interface ICalloutSeriesPrivate extends ILabelSeriesPrivate {\r\n}\r\n\r\nexport class CalloutSeries extends LabelSeries {\r\n\tpublic static className: string = \"CalloutSeries\";\r\n\tpublic static classNames: Array<string> = LabelSeries.classNames.concat([CalloutSeries.className]);\r\n\r\n\tdeclare public _settings: ICalloutSeriesSettings;\r\n\tdeclare public _privateSettings: ICalloutSeriesPrivate;\r\n\tdeclare public _dataItemSettings: ICalloutSeriesDataItem;\r\n\r\n\tprotected _tag = \"callout\";\r\n\r\n\tprotected _tweakBullet2(label: Label, dataItem: DataItem<ICalloutSeriesDataItem>) {\r\n\t\tconst dataContext = dataItem.dataContext as any;\r\n\t\tconst background = label.set(\"background\", PointedRectangle.new(this._root, { themeTags: [\"callout\"] }, dataContext.bgSettings));\r\n\t\tdataContext.background = background;\r\n\t}\r\n\r\n\tprotected _tweakBullet(container: Container, dataItem: DataItem<ICalloutSeriesDataItem>) {\r\n\t\tsuper._tweakBullet(container, dataItem);\r\n\r\n\t\tcontainer.events.off(\"click\");\r\n\r\n\t\tconst dataContext = dataItem.dataContext as any;\r\n\t\tconst template = dataContext.settings;\r\n\r\n\t\tif (template) {\r\n\t\t\tconst label = this.getPrivate(\"label\");\r\n\t\t\tif (label) {\r\n\t\t\t\tlabel.events.on(\"positionchanged\", () => {\r\n\t\t\t\t\tthis._root.events.once(\"frameended\", () => {\r\n\t\t\t\t\t\tthis._updatePointer(label);\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\r\n\t\t\t\tlabel.events.on(\"click\", (e) => {\r\n\t\t\t\t\tconst spriteResizer = this.spriteResizer;\r\n\t\t\t\t\tif (spriteResizer.get(\"sprite\") == label) {\r\n\t\t\t\t\t\tthis._isEditing = true;\r\n\t\t\t\t\t\tlabel.set(\"active\", true);\r\n\t\t\t\t\t\tthis._selectDrawing(dataContext.index, (e.originalEvent as any).ctrlKey, true);\r\n\t\t\t\t\t\tspriteResizer.set(\"sprite\", undefined);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis._isEditing = false;\r\n\t\t\t\t\t\tthis._isSelected = true;\r\n\t\t\t\t\t\tthis._selectDrawing(dataContext.index, (e.originalEvent as any).ctrlKey, true);\r\n\t\t\t\t\t\tspriteResizer.set(\"sprite\", label);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this._erasingEnabled) {\r\n\t\t\t\t\t\tthis._disposeIndex(dataContext.index);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\tlabel.on(\"scale\", () => {\r\n\t\t\t\t\tthis._updatePointer(label);\r\n\t\t\t\t})\r\n\r\n\t\t\t\tlabel.on(\"rotation\", () => {\r\n\t\t\t\t\tthis._updatePointer(label);\r\n\t\t\t\t})\r\n\r\n\t\t\t\tlabel.setAll({ draggable: true });\r\n\r\n\t\t\t\tlabel.on(\"x\", (x) => {\r\n\t\t\t\t\ttemplate.set(\"x\", x);\r\n\t\t\t\t})\r\n\r\n\t\t\t\tlabel.on(\"y\", (y) => {\r\n\t\t\t\t\ttemplate.set(\"y\", y);\r\n\t\t\t\t})\r\n\r\n\t\t\t\tconst defaultState = label.states.lookup(\"default\")!;\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tlabel.animate({ key: \"y\", to: -label.height() / 2 - 10, from: 0, duration: defaultState.get(\"stateAnimationDuration\", 500), easing: defaultState.get(\"stateAnimationEasing\", $ease.out($ease.cubic)) })\r\n\t\t\t\t}, 50)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _updatePointer(label: Label) {\r\n\t\tconst background = label.get(\"background\");\r\n\t\tif (background instanceof PointedRectangle) {\r\n\t\t\tconst parent = label.parent;\r\n\t\t\tif (parent) {\r\n\t\t\t\tlet point = parent.toGlobal({ x: 0, y: 0 });\r\n\t\t\t\tpoint = background.toLocal(point);\r\n\t\t\t\tbackground.setAll({ pointerX: point.x, pointerY: point.y });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.markDirty();\r\n\t}\r\n\r\n\tprotected _afterTextSave(dataContext: any) {\r\n\t\tdataContext.bgSettings = this._getBgTemplate();\r\n\t}\r\n\r\n\tprotected _hideAllBullets() {\r\n\r\n\t}\r\n\r\n\tprotected _getBgTemplate(): Template<any> {\r\n\t\tconst template: any = {};\r\n\r\n\t\tconst fill = this.get(\"fillColor\");\r\n\t\tif (fill != null) {\r\n\t\t\ttemplate.fill = fill;\r\n\t\t}\r\n\r\n\t\tconst fillOpacity = this.get(\"fillOpacity\");\r\n\t\tif (fillOpacity != null) {\r\n\t\t\ttemplate.fillOpacity = fillOpacity;\r\n\t\t}\r\n\r\n\t\tconst strokeOpacity = this.get(\"strokeOpacity\");\r\n\t\tif (strokeOpacity != null) {\r\n\t\t\ttemplate.strokeOpacity = strokeOpacity;\r\n\t\t}\r\n\r\n\t\tconst stroke = this.get(\"strokeColor\");\r\n\t\tif (stroke != null) {\r\n\t\t\ttemplate.stroke = stroke;\r\n\t\t}\r\n\r\n\t\treturn Template.new(template);\r\n\t}\r\n\r\n\tprotected _applySettings(index: number, settings?: { [index: string]: any }) {\r\n\t\tsuper._applySettings(index, settings);\r\n\r\n\t\tconst context = this._getContext(index);\r\n\t\tif (context && settings) {\r\n\t\t\tconst background = context.background;\r\n\r\n\t\t\tif (background) {\r\n\t\t\t\tlet template = context.bgSettings;\r\n\r\n\t\t\t\tif (settings.fill != undefined) {\r\n\t\t\t\t\tbackground.set(\"fill\", settings.fill);\r\n\t\t\t\t\ttemplate.set(\"fill\", settings.fill);\r\n\t\t\t\t}\r\n\t\t\t\tif (settings.fillOpacity != undefined) {\r\n\t\t\t\t\tbackground.set(\"fillOpacity\", settings.fillOpacity);\r\n\t\t\t\t\ttemplate.set(\"fillOpacity\", settings.fillOpacity);\r\n\t\t\t\t}\r\n\t\t\t\tif (settings.strokeOpacity != undefined) {\r\n\t\t\t\t\tbackground.set(\"strokeOpacity\", settings.strokeOpacity);\r\n\t\t\t\t\ttemplate.set(\"strokeOpacity\", settings.strokeOpacity);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (settings.stroke != undefined) {\r\n\t\t\t\t\tbackground.set(\"stroke\", settings.stroke);\r\n\t\t\t\t\ttemplate.set(\"stroke\", settings.stroke);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}"]}